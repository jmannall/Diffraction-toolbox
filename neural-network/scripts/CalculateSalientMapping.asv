%% Biquad loss function for training neural networks

function gradients = CalculateSalientMapping(net, inputData, targetData, lossFunc)

    output = predict(net, inputData);
    [numOutputs, numInputs] = size(output);

    loss = lossFunc(output, targetData);
    gradients = dlgradient(sum(output(1,:)) / numInputs, net.Learnables);
    for i = 1:numInputs
        loss = lossFunc(output(:,i), targetData(:,i));
        gradients{i} = dlgradient(loss, inputData(:,i));
    end
end